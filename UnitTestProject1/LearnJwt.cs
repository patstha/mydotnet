using FluentAssertions;
using Microsoft.IdentityModel.Tokens;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Newtonsoft.Json;
using System;
using System.IdentityModel.Tokens.Jwt;
using System.Security.Cryptography;
using System.Text;

namespace LearnJwt
{
    [TestClass]
    public class LearnJwt
    {
        public string BuildToken(string email, long timestamp, string clientSecret)
        {
            string header = BuildTokenHeader();
            string payload = BuildTokenPayload(email, timestamp);

            string base64Header = Base64UrlEncode(header);
            string base64Payload = Base64UrlEncode(payload);

            return GetHMACSHA256(base64Header + "." + base64Payload, clientSecret);
        }

        private string GetHMACSHA256(string token, string clientSecret)
        {
            var sha = new HMACSHA512(Encoding.UTF8.GetBytes(clientSecret));
            var hashedByteArray = sha.ComputeHash(Encoding.UTF8.GetBytes(token));

            //You need to base64UrlEncode the signature hash value
            var partThree = Base64UrlEncode(Encoding.UTF8.GetString(hashedByteArray));

            //Now construct the token
            var tokenString = string.Join(".", token, partThree);
            return tokenString;
        }

        private string BuildTokenHeader()
        {
            //return "{ ""alg"": ""HS256"",""typ"": ""JWT"" }";
            return JsonConvert.SerializeObject(new { alg = "HS256", typ = "JWT" });
        }

        private string BuildTokenPayload(string inputEmail, long inputTimestamp)
        {
            var payload = JsonConvert.SerializeObject(new { email = inputEmail, iat = inputTimestamp });
            return payload;
        }

        // from JWT spec
        private static string Base64UrlEncode(string plainText)
        {
            byte[] input = Encoding.UTF8.GetBytes(plainText);
            string output = Convert.ToBase64String(input);
            output = output.Split('=')[0]; // Remove any trailing '='s
            output = output.Replace('+', '-'); // 62nd char of encoding
            output = output.Replace('/', '_'); // 63rd char of encoding
            return output;
        }

        public string GenerateSignature(JwtPayload payload, string clientSecret)
        {
            SymmetricSecurityKey securityKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(clientSecret));
            SigningCredentials credentials = new SigningCredentials(securityKey, SecurityAlgorithms.HmacSha256Signature);
            JwtHeader header = new JwtHeader(credentials);
            JwtSecurityToken secToken = new JwtSecurityToken(header, payload);
            JwtSecurityTokenHandler handler = new JwtSecurityTokenHandler();
            string tokenString = handler.WriteToken(secToken);
            return tokenString;
        }

        [TestMethod]
        public void TestMethod1()
        {
            // Arrange
            string expectedEmail = "appleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebra@gmx.com";
            long expectedTimestamp = DateTimeOffset.Now.ToUnixTimeSeconds();
            string clientSecret = "appleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebra";
            var payload = new JwtPayload
            {
                { "email", expectedEmail },
                { "iat", expectedTimestamp }
            };

            // Act 
            string token = GenerateSignature(payload, clientSecret);

            JwtSecurityTokenHandler handler = new JwtSecurityTokenHandler();
            JwtSecurityToken jwtSecurityToken = handler.ReadJwtToken(token);

            // Assert
            jwtSecurityToken.Payload.Count.Should().Be(2);
            jwtSecurityToken.Payload.ContainsKey("email");
            jwtSecurityToken.Payload.ContainsKey("iat");
            jwtSecurityToken.Payload.ContainsValue(expectedEmail);
            jwtSecurityToken.Payload.ContainsValue(expectedTimestamp);
        }


        [TestMethod]
        public void TestMethod2()
        {
            // Arrange
            string expectedEmail = "appleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebraappleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebra@gmx.com";
            long expectedTimestamp = DateTimeOffset.Now.ToUnixTimeSeconds();
            string clientSecret = "appleballcatdogeggfishgunhenicejugkitelionmonkeynestorangequeenroseshipteaumbrellavanwaterxylophoneyachtzebra";

            // Act 
            string token = BuildToken(expectedEmail, expectedTimestamp, clientSecret);

            JwtSecurityTokenHandler handler = new JwtSecurityTokenHandler();
            JwtSecurityToken jwtSecurityToken = handler.ReadJwtToken(token);

            // Assert
            jwtSecurityToken.Payload.Count.Should().Be(2);
            jwtSecurityToken.Payload.ContainsKey("email");
            jwtSecurityToken.Payload.ContainsKey("iat");
            jwtSecurityToken.Payload.ContainsValue(expectedEmail);
            jwtSecurityToken.Payload.ContainsValue(expectedTimestamp);
        }
    }
}
